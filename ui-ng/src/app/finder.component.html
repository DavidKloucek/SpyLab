<div class="container">
    <mat-card appearance="outlined">
        <mat-card-header>
            <mat-card-title>Find a face by..</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <form
                (ngSubmit)="onSubmit()"
                fxLayout="row"
                fxLayoutAlign="start center"
            >
                <mat-tab-group>
                    <mat-tab label="An image">
                        <mat-card class="file-upload-card" fxFlex="1">
                            <mat-card-content>
                                <div
                                    class="file-drop-area"
                                    (dragover)="onDragOver($event)"
                                    (drop)="onDrop($event)"
                                    (click)="fileInput.click()"
                                    matRipple
                                >
                                    <input
                                        #fileInput
                                        type="file"
                                        (change)="onFileSelected($event)"
                                        accept="image/*"
                                        style="display: none"
                                    />
                                    <mat-icon class="upload-icon"
                                        >cloud_upload</mat-icon
                                    >
                                    <span
                                        >Drag an image here or click to
                                        select.</span
                                    >
                                </div>
                            </mat-card-content>
                        </mat-card>
                    </mat-tab>
                </mat-tab-group>

                <button
                    mat-raised-button
                    color="primary"
                    type="submit"
                    fxFlex="none"
                    [disabled]="analyzeImgMut.isPending()"
                >
                    Submit
                </button>
                @if (analyzeImgMut.isPending()) {
                <mat-spinner diameter="30"></mat-spinner>
                }
            </form>
        </mat-card-content>
    </mat-card>

    @if (selectedImageStr()) {
    <mat-card appearance="outlined">
        <mat-card-header>
            <mat-card-title>Select a face..</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <detail-modal-image
                [sourceUrl]="selectedImageStr()"
                [itemData]="analyzedBoxes()"
                (clickFace)="clickFace($event)"
            />
        </mat-card-content>
    </mat-card>
    } @if (tableData().length > 0 || findByImageQry.isFetching()) {
    <mat-card class="file-upload-card" fxFlex="1">
        <mat-card-header>
            <mat-card-title>Matches</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            @if (findByImageQry.isPending()) {
            <mat-spinner diameter="30"></mat-spinner>
            }
            <table mat-table [dataSource]="tableData()">
                <ng-container
                    *ngFor="let column of columns"
                    [matColumnDef]="column.id!"
                >
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ column.header }}
                    </th>
                    <td mat-cell *matCellDef="let row">
                        @if (column.id === 'preview_url') {
                        <ng-container>
                            <img
                                loading="lazy"
                                (click)="openDialog(row)"
                                [src]="
                                    analyzedImage()?.preview_url +
                                    row['preview_path']
                                "
                                alt="Preview"
                                width="100"
                                height="100"
                            />
                        </ng-container>
                        } @else if (column.id === 'id') {
                        {{ row[column.id!] }}
                        }@else if (column.id === 'confidence') {
                        {{ row[column.id!] }}% } @else if (column.id ===
                        'is_same') { @if (row['is_same']) {
                        <mat-chip
                            class="mat-primary"
                            class="mat-primary"
                            selected
                            >Yes</mat-chip
                        >
                        } @else {
                        <mat-chip class="mat-warn" selected>No</mat-chip>
                        } }@else {
                        <ng-container>
                            {{ row[column.id!] }}
                        </ng-container>
                        }
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="tableCols"></tr>
                <tr mat-row *matRowDef="let row; columns: tableCols"></tr>
            </table>
        </mat-card-content>
    </mat-card>
    }
</div>
